---
phase: 01-collapsible-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .vitepress/components/CollapsibleResumeItem.vue
autonomous: false

must_haves:
  truths:
    - "User can click the header row to toggle between collapsed and expanded content"
    - "Component renders collapsed on initial load, showing approximately one line of content with a gradient fade-out"
    - "A chevron icon rotates to reflect expanded/collapsed state"
    - "Content slides open and closed with a smooth CSS animation (no jump or flicker)"
    - "HTML content strings passed via the description prop render correctly in both states"
  artifacts:
    - path: ".vitepress/components/CollapsibleResumeItem.vue"
      provides: "Collapsible resume item component with expand/collapse behavior"
      exports: ["default"]
      contains: "defineProps"
  key_links:
    - from: ".vitepress/components/CollapsibleResumeItem.vue"
      to: "description prop (v-html)"
      via: "v-html directive renders HTML string content"
      pattern: "v-html.*description"
    - from: ".vitepress/components/CollapsibleResumeItem.vue"
      to: "CSS transition system"
      via: "max-height transition on content-wrapper"
      pattern: "transition.*max-height"
    - from: ".vitepress/components/CollapsibleResumeItem.vue"
      to: "VitePress theme variables"
      via: "var(--vp-c-bg) for fade gradient, var(--vp-c-text-3) for chevron"
      pattern: "--vp-c-bg|--vp-c-text-3"
---

<objective>
Build the complete CollapsibleResumeItem Vue component with all expand/collapse behavior, animation, and visual presentation.

Purpose: This is the only deliverable for Phase 1 — a standalone component that can later be integrated into the resume page (Phase 2). It must handle collapsed preview with fade, smooth height animation, rotating chevron indicator, and HTML content rendering.

Output: `.vitepress/components/CollapsibleResumeItem.vue` — a production-ready Vue 3 SFC.
</objective>

<execution_context>
@/Users/michael.wurster/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/michael.wurster/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-collapsible-component/01-CONTEXT.md
@.planning/phases/01-collapsible-component/01-RESEARCH.md
@.vitepress/components/ResumeItem.vue
@.vitepress/components/ResumeSection.vue
@.vitepress/theme/index.ts
@resume.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build CollapsibleResumeItem component</name>
  <files>.vitepress/components/CollapsibleResumeItem.vue</files>
  <action>
Create `.vitepress/components/CollapsibleResumeItem.vue` as a Vue 3 SFC with `<script setup lang="ts">`, `<template>`, and `<style scoped>` blocks.

**Props (via `defineProps<{...}>()`):**
- `title: string` — header text displayed on the left
- `description: string` — HTML content string rendered via `v-html`

**Script setup:**
- Import `ref` and `onMounted` from `vue`
- `expanded = ref(false)` — starts collapsed (CORE-02). Must be `false` to avoid SSR hydration mismatch.
- `contentRef = ref<HTMLElement | null>(null)` — template ref for the content wrapper
- `contentHeight = ref(0)` — stores measured `scrollHeight` of content
- `toggle()` function: flips `expanded.value`
- `onMounted()`: measure `contentRef.value.scrollHeight` and store in `contentHeight`. All DOM access MUST be inside `onMounted` — never in top-level setup (SSR pitfall).

**Template structure:**
```html
<div :class="['collapsible-box', { expanded }]">
  <button class="collapsible-header" @click="toggle" :aria-expanded="expanded">
    <span class="collapsible-title">{{ title }}</span>
    <span class="chevron" aria-hidden="true" />
  </button>
  <div
    ref="contentRef"
    class="content-wrapper"
    :style="expanded ? { maxHeight: contentHeight + 'px' } : undefined"
  >
    <div class="content" v-html="description"></div>
  </div>
</div>
```

Key template decisions:
- Header is a `<button>` element (not `<div>`) — provides free keyboard support (Enter/Space), focus, and screen reader semantics. Requires resetting button styles in CSS.
- `:style` binding only applies `maxHeight` when expanded. Collapsed state uses CSS class value (`1.5em`). This avoids hydration mismatch since initial render has no inline style.
- Use `collapsible-box` and `collapsible-header` as class names to avoid conflicts with ResumeItem's `.box` and `.box-header` classes.

**Scoped styles — implement ALL of these:**

1. `.collapsible-box` — Match existing ResumeItem card styling:
   - `border: 1px solid #e1e9ee`
   - `border-radius: 8px`
   - `padding: 15px`
   - `margin-bottom: 20px`
   - `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)`

2. `.collapsible-header` — Reset button styles + flexbox layout:
   - `display: flex; align-items: center; justify-content: space-between; width: 100%`
   - Reset: `background: none; border: none; padding: 0; cursor: pointer; font: inherit; color: inherit; text-align: left`
   - `margin-bottom: 0.5rem` (space between header and content)

3. `.collapsible-title` — Match ResumeItem title:
   - `font-size: 1.1rem; font-weight: 600`

4. `.chevron` — CSS border triangle per user decision:
   - Per LOCKED decision: sits on right side, points right when collapsed, rotates down when expanded, subtle/muted
   - `border: solid var(--vp-c-text-3); border-width: 0 1.5px 1.5px 0`
   - `display: inline-block; padding: 3px`
   - `transform: rotate(-45deg)` (points right when collapsed)
   - `transition: transform 0.3s ease`
   - `flex-shrink: 0; margin-left: 12px`

5. `.expanded .chevron` — Rotate to down:
   - `transform: rotate(45deg)`

6. `.collapsible-header:hover .chevron` — Subtle hover feedback:
   - `border-color: var(--vp-c-text-2)` (slightly more prominent on hover)

7. `.content-wrapper` — Animation container:
   - `max-height: 1.5em` (collapsed preview height — shows ~1 line)
   - `overflow: hidden; position: relative`
   - `transition: max-height 0.3s ease`
   - Do NOT put `overflow: hidden` on `.collapsible-box` — it clips box-shadow

8. `.content-wrapper::after` — Gradient fade overlay:
   - `content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1.5em`
   - `background: linear-gradient(transparent, var(--vp-c-bg))` — auto-matches light/dark theme
   - `pointer-events: none` — doesn't block clicks
   - `transition: opacity 0.3s ease`

9. `.expanded .content-wrapper::after` — Hide fade when expanded:
   - `opacity: 0`

10. `.content` — Match ResumeItem description styling:
    - `font-size: .9rem; font-weight: 400; margin: 0`

11. `:deep()` rules for v-html content — Copy from ResumeItem.vue:
    - `:deep(.content ul)` — `margin-top: .3rem; padding-left: 1.2rem; margin-bottom: .3rem`
    - `:deep(.content li)` — `margin-top: 0.2rem`
    - `:deep(.content a)` — `font-weight: 400`
    - `:deep(.content > :first-child)` — `margin-top: 0` (normalize first-child margin to prevent blank preview)
    - `:deep(.content p)` — `margin: 0; line-height: 1.3rem` (match ResumeItem p styling)

**What NOT to do:**
- Do NOT use `grid-template-rows: 0fr/1fr` — does not support partial-collapse preview (research finding)
- Do NOT use `max-height: 9999px` — causes delayed collapse animation
- Do NOT use Vue `<Transition>` component — content stays in DOM always, CSS transition is simpler
- Do NOT access `scrollHeight` outside `onMounted()` — breaks SSR build
- Do NOT add decorations/borders to collapsed state — per user locked decision, chevron alone signals state
  </action>
  <verify>
1. File exists: `ls .vitepress/components/CollapsibleResumeItem.vue`
2. Build succeeds: `npm run docs:build` (no SSR errors — confirms onMounted guard works)
3. Component has required props: grep for `defineProps` with `title` and `description`
4. Component uses CSS transition: grep for `transition.*max-height`
5. Component uses VitePress theme vars: grep for `--vp-c-bg` and `--vp-c-text-3`
6. Chevron rotates: grep for `rotate(-45deg)` and `rotate(45deg)`
7. No SSR-unsafe code: grep confirms no `document`, `window`, or `scrollHeight` outside `onMounted`
  </verify>
  <done>
- CollapsibleResumeItem.vue exists in .vitepress/components/
- `npm run docs:build` passes without errors
- Component accepts `title` (string) and `description` (string) props
- Collapsed state shows ~1 line preview with gradient fade using var(--vp-c-bg)
- Expanded state shows full v-html content with fade hidden
- Header is a button element with flexbox layout (title left, chevron right)
- Chevron points right when collapsed, down when expanded (CSS border triangle with var(--vp-c-text-3))
- Content animates via max-height CSS transition (0.3s ease)
- Chevron and content transitions use same timing (0.3s ease)
- aria-expanded attribute reflects state on header button
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of component behavior</name>
  <files>resume.md</files>
  <action>
Temporarily register CollapsibleResumeItem in `.vitepress/theme/index.ts` and replace the Profile `<ResumeItem>` in `resume.md` with `<CollapsibleResumeItem title="Profile" :description="profile"/>` to visually verify the component. Start the dev server with `npm run docs:dev`. Present the checkpoint to the user. After approval, revert `resume.md` and `index.ts` to their original state (the temporary registration will be done properly in Phase 2).

**What was built:** CollapsibleResumeItem component with all expand/collapse behavior, animation, chevron indicator, and gradient fade.
  </action>
  <verify>
User visually confirms all behaviors listed below by interacting with the component in the browser.
  </verify>
  <done>
User types "approved" confirming the component works correctly.
  </done>
  <what-built>
CollapsibleResumeItem component with all expand/collapse behavior, animation, chevron indicator, and gradient fade. The component is built but not yet integrated into the site (that's Phase 2). To test visually, we temporarily add it to resume.md.
  </what-built>
  <how-to-verify>
1. Run `npm run docs:dev` to start the local dev server
2. Open http://localhost:5173/resume in your browser
3. The executor will temporarily register the component and add test usage to resume.md:

   Below the `## Profile` heading, replace `<ResumeItem :description="profile"/>` with:
   ```
   <CollapsibleResumeItem title="Profile" :description="profile"/>
   ```

4. Verify these behaviors:

   **Collapsed state (initial load):**
   - [ ] Component shows as a card matching ResumeItem styling (border, rounded corners, shadow)
   - [ ] Header row shows "Profile" on the left, small chevron on the right
   - [ ] Chevron points right (subtle, muted color)
   - [ ] ~1 line of content visible below the header
   - [ ] Content fades out at the bottom (gradient overlay)
   - [ ] No extra borders, backgrounds, or decorations beyond the card itself

   **Expand (click header):**
   - [ ] Content slides open smoothly (no jump or flicker)
   - [ ] Chevron rotates from right to down
   - [ ] Fade overlay disappears
   - [ ] Full HTML content is visible and correctly rendered

   **Collapse (click header again):**
   - [ ] Content slides closed smoothly back to ~1 line preview
   - [ ] Chevron rotates back from down to right
   - [ ] Fade overlay reappears
   - [ ] Animation feels synchronized (chevron and content move together)

   **Keyboard:**
   - [ ] Tab to the header — focus ring visible
   - [ ] Press Enter or Space — toggles expand/collapse

5. After verification, the executor will revert resume.md and index.ts to their original state.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npm run docs:build` passes — confirms SSR compatibility, no build errors
2. Component file exists at `.vitepress/components/CollapsibleResumeItem.vue`
3. All CORE requirements addressed:
   - CORE-01: Click header to toggle → button with @click="toggle"
   - CORE-02: Starts collapsed → expanded = ref(false)
   - CORE-03: ~1 line preview with fade → max-height: 1.5em + ::after gradient
   - CORE-04: Chevron rotates → CSS transform rotate(-45deg) ↔ rotate(45deg)
   - CORE-05: Smooth CSS animation → transition: max-height 0.3s ease
   - CORE-06: HTML via v-html → <div class="content" v-html="description">
4. User locked decisions honored:
   - Chevron on right side of header (flexbox justify-content: space-between)
   - Points right collapsed, down expanded (rotate -45deg/45deg)
   - Subtle muted color (var(--vp-c-text-3))
   - No extra decorations on collapsed state
</verification>

<success_criteria>
- CollapsibleResumeItem.vue is a complete, buildable Vue 3 SFC in .vitepress/components/
- `npm run docs:build` succeeds without errors
- Component visually matches ResumeItem card styling
- Collapsed state shows ~1 line preview with gradient fade
- Expand/collapse animates smoothly via CSS transition
- Chevron rotates right↔down on toggle, subtle muted color
- HTML content renders correctly via v-html in both states
- Keyboard accessible (button element, Enter/Space toggle)
- User approves visual behavior at checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/01-collapsible-component/01-01-SUMMARY.md`
</output>
